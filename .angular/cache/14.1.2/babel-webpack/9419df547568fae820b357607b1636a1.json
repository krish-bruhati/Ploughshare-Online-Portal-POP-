{"ast":null,"code":"import { InteractionStatus, EventType } from '@azure/msal-browser';\nimport { Subject } from 'rxjs';\nimport { filter, takeUntil } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@azure/msal-angular\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/material/button\";\nimport * as i5 from \"@angular/material/toolbar\";\n\nfunction AppComponent_a_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"a\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"Welcome \", ctx_r0.activeUser, \"\");\n  }\n}\n\nfunction AppComponent_button_7_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 9);\n    i0.ɵɵlistener(\"click\", function AppComponent_button_7_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.login());\n    });\n    i0.ɵɵtext(1, \"Login\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction AppComponent_button_8_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 10);\n    i0.ɵɵlistener(\"click\", function AppComponent_button_8_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r5 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r5.logout());\n    });\n    i0.ɵɵtext(1, \"Logout\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nexport let AppComponent = /*#__PURE__*/(() => {\n  class AppComponent {\n    constructor(msalService, msalBroadcastService, router) {\n      this.msalService = msalService;\n      this.msalBroadcastService = msalBroadcastService;\n      this.router = router;\n      this.title = 'Ploughshare Online Portal';\n      this.activeUser = \"unknown user\";\n      this.activeUserId = \"unknown user\";\n      this.isAuthenticated = false;\n      this.unsubscribe = new Subject();\n    }\n\n    login() {\n      this.msalService.instance.loginRedirect({\n        scopes: [\"User.Read\"] //if (!Request.IsAuthenticated)\n\n      }); //let activeAccount = this.msalService.instance.getActiveAccount();\n      //this.router.navigate(['/user1']);\n    } // login(): void{\n    //     this.msalService.instance.loginRedirect().then(()=>{\n    //         this.router.navigate(['/user1']);\n    //     });\n    // }\n    // loginUser(): void{\n    //     this.isAuthenticated.login().\n    // }\n\n\n    logout() {\n      this.msalService.instance.logoutRedirect(); //this.router.navigate(['/home']);\n    }\n\n    ngOnInit() {\n      this.msalBroadcastService.inProgress$.pipe(filter(status => status == InteractionStatus.None), takeUntil(this.unsubscribe)).subscribe(() => {\n        this.setAuthenticationStatus();\n      });\n      this.msalBroadcastService.msalSubject$.pipe(filter(message => message.eventType === EventType.LOGIN_SUCCESS), takeUntil(this.unsubscribe)).subscribe(message => {\n        const authResult = message.payload;\n        this.msalService.instance.setActiveAccount(authResult.account);\n      });\n    }\n\n    ngOnDestroy() {\n      this.unsubscribe.next(undefined);\n      this.unsubscribe.complete();\n    }\n\n    setAuthenticationStatus() {\n      let activeAccount = this.msalService.instance.getActiveAccount();\n\n      if (!activeAccount && this.msalService.instance.getAllAccounts().length > 0) {\n        activeAccount = this.msalService.instance.getAllAccounts()[0];\n        this.msalService.instance.setActiveAccount(activeAccount);\n      }\n\n      this.isAuthenticated = !!activeAccount;\n      this.activeUserId = activeAccount?.username;\n      this.activeUser = activeAccount?.name; //If you want to add more page please add user roles here\n\n      if (this.activeUserId?.includes(\"krishan.patel@ploughshare.co.uk\")) {\n        this.router.navigate(['/user1']);\n      } else if (this.activeUserId?.includes(\"liam.vermeulen@ploughshare.co.uk\")) {\n        this.router.navigate(['/user2']);\n      } else if (this.activeUserId?.includes(\"harrison.hibbert@ploughshare.co.uk\")) {\n        this.router.navigate(['/user3']);\n      } else {\n        this.router.navigate(['/home']);\n      }\n    }\n\n  }\n\n  AppComponent.ɵfac = function AppComponent_Factory(t) {\n    return new (t || AppComponent)(i0.ɵɵdirectiveInject(i1.MsalService), i0.ɵɵdirectiveInject(i1.MsalBroadcastService), i0.ɵɵdirectiveInject(i2.Router));\n  };\n\n  AppComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: AppComponent,\n    selectors: [[\"app-root\"]],\n    decls: 11,\n    vars: 4,\n    consts: [[\"href\", \"https://fonts.googleapis.com/css?family=Lexend Deca\", \"rel\", \"stylesheet\"], [\"color\", \"primary\"], [\"src\", \"https://ploughshare.co.uk/wp-content/themes/Eldo/images/logo-white.png\", \"alt\", \"Architecture\", \"width\", \"180\", \"height\", \"40\", 1, \"w3-image\"], [\"href\", \"/\", 1, \"title\"], [1, \"toolbar-spacer\"], [4, \"ngIf\"], [\"mat-raised-button\", \"\", 3, \"click\", 4, \"ngIf\"], [\"mat-raised-button\", \"\", \"color\", \"accent\", 3, \"click\", 4, \"ngIf\"], [1, \"container\"], [\"mat-raised-button\", \"\", 3, \"click\"], [\"mat-raised-button\", \"\", \"color\", \"accent\", 3, \"click\"]],\n    template: function AppComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelement(0, \"link\", 0);\n        i0.ɵɵelementStart(1, \"mat-toolbar\", 1);\n        i0.ɵɵelement(2, \"img\", 2);\n        i0.ɵɵelementStart(3, \"a\", 3);\n        i0.ɵɵtext(4);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(5, \"div\", 4);\n        i0.ɵɵtemplate(6, AppComponent_a_6_Template, 2, 1, \"a\", 5);\n        i0.ɵɵtemplate(7, AppComponent_button_7_Template, 2, 0, \"button\", 6);\n        i0.ɵɵtemplate(8, AppComponent_button_8_Template, 2, 0, \"button\", 7);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(9, \"div\", 8);\n        i0.ɵɵelement(10, \"router-outlet\");\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(4);\n        i0.ɵɵtextInterpolate(ctx.title);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.isAuthenticated);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", !ctx.isAuthenticated);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.isAuthenticated);\n      }\n    },\n    dependencies: [i3.NgIf, i2.RouterOutlet, i4.MatButton, i5.MatToolbar],\n    styles: [\".toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}a.title[_ngcontent-%COMP%]{color:#fff;text-align:center}.card-section[_ngcontent-%COMP%]{margin:10%;padding:5%}\"]\n  });\n  return AppComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}